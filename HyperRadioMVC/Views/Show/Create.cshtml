@model HyperRadioMVC.ViewModels.CreateShowVM

<link rel="stylesheet" href="~/css/trackpitch.css" asp-append-version="true" />


@{
    ViewBag.Title = "title";
    Layout = "_Layout";
}


<div class="form">
    <h1 class="form-title">Submit a Track</h1>

    <form id="multi-step-form" class="form-body" action="http://localhost:5054/api/shows" method="post">

        <div class="form-step active">
        <div class="form-field">
            <label asp-for="Name" class="form-label">Show Name</label>
            <input type="text" asp-for="Name" class="form-control" required />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <div class="form-field">
            <label asp-for="Description" class="form-label">Show Description</label>
            <input type="text" asp-for="Description" class="form-control" required />
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

            <div class="form-nav">
                <button type="button" class="form-btn next-btn">Next →</button>
            </div>

            
        </div>


        <div class="form-step">
            <div class="form-field">
                <label class="form-label">Tracks (in order)</label>
                <div id="track-select-container">
                    <div class="track-select">
                        <select name="TrackIds" class="form-select track-dropdown" required></select>
                    </div>
                </div>

                <button type="button" id="add-track-btn" class="form-btn" style="margin-top: 0.5rem;">
                    + Add another track
                </button>
                
                <div class="form-nav">
                <button type="button" class="form-btn back-btn">← Back</button>
                    <button type="submit" class="form-btn submit-btn" style="margin-top: 1rem;">Create Show</button>
                </div>
            </div>

        </div>
    </form>
</div>





<script>
document.addEventListener("DOMContentLoaded", async () => {
    // ===== Multi-step Form Logic =====
    const steps = document.querySelectorAll(".form-step");
    const nextBtns = document.querySelectorAll(".next-btn");
    const backBtns = document.querySelectorAll(".back-btn");
    let currentStep = 0;

    function showStep(index) {
        steps.forEach((step, i) => {
            step.classList.toggle("active", i === index);
        });
    }

    nextBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            currentStep = Math.min(currentStep + 1, steps.length - 1);
            showStep(currentStep);
        });
    });

    backBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            currentStep = Math.max(currentStep - 1, 0);
            showStep(currentStep);
        });
    });

    // ===== Dynamic Track Dropdowns =====
    const container = document.getElementById("track-select-container");
    const addBtn = document.getElementById("add-track-btn");
    const apiUrl = "http://localhost:5054/api/Tracks"; // Adjust to your API

    let tracks = [];

    // Fetch all tracks from API
    async function fetchTracks() {
        try {
            const res = await fetch(apiUrl);
            if (!res.ok) throw new Error("Failed to load tracks");
            tracks = await res.json();
        } catch (err) {
            console.error("❌ Error fetching tracks:", err);
            alert("Could not load track list from server.");
        }
    }

    // Populate a <select> element with track options
    function populateDropdown(select) {
        select.innerHTML = '<option value="">Select a track</option>';
        tracks.forEach(track => {
            const opt = document.createElement("option");
            opt.value = track.id;
            opt.textContent = track.title || track.name || `Track ${track.id}`;
            select.appendChild(opt);
        });
    }

    // Add a new dropdown row
    function addTrackDropdown() {
        const wrapper = document.createElement("div");
        wrapper.className = "track-select";
        const select = document.createElement("select");
        select.name = "TrackIds";
        select.className = "form-select track-dropdown";
        select.required = true;

        populateDropdown(select);
        wrapper.appendChild(select);

        // Optional remove button
        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.textContent = "️ Remove";
        removeBtn.className = "form-btn back-btn";
        removeBtn.style.marginLeft = "0.5rem";
        removeBtn.addEventListener("click", () => wrapper.remove());

        wrapper.appendChild(removeBtn);
        container.appendChild(wrapper);
    }

    // ===== Initialize =====
    await fetchTracks();

    // Populate first existing dropdown if present
    const firstDropdown = document.querySelector(".track-dropdown");
    if (firstDropdown) populateDropdown(firstDropdown);

    // Add new dropdowns on click
    addBtn.addEventListener("click", addTrackDropdown);
});
</script>