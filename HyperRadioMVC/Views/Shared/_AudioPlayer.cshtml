<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HLS Audio Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="~/css/audioplayer.css" />
</head>

<body>
<div id="audio-player">
    <audio id="audioPlayer"></audio>

    <div id="now-playing" class="now-playing">
        <span id="song-title">Now Playing:</span>
        <strong id="song-name">Sample Song</strong>
        <p id="artist-name">Artist name</p>
    </div>

    <div class="player-controls">
        <button id="play-btn" class="control-btn">Play</button>
        <button id="pause-btn" class="control-btn hidden">Pause</button>
    </div>

    <div class="player-volume">
        <input id="volume" type="range" min="0" max="1" step="0.1" value="1" />
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const audio = document.getElementById("audioPlayer");
        const streamUrl = "https://localhost:5054/api/stream/live.m3u8"; // ✅ your backend endpoint

        // ✅ Many modern browsers can play audio HLS natively
        if (audio.canPlayType("application/vnd.apple.mpegurl")) {
            audio.src = streamUrl;
            audio.play();
        } else {
            // For browsers that don't support HLS natively (like Chrome), use hls.js
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/hls.js@latest";
            script.onload = () => {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(streamUrl);
                    hls.attachMedia(audio);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => audio.play());
                } else {
                    alert("Your browser does not support HLS audio streaming.");
                }
            };
            document.body.appendChild(script);
        }
 
        // Play / Pause buttons
        playBtn.addEventListener('click', function () {
            audio.play().catch(err => console.warn('Play failed:', err));
            playBtn.classList.add('hidden');
            pauseBtn.classList.remove('hidden');
        });

        pauseBtn.addEventListener('click', function () {
            audio.pause();
            pauseBtn.classList.add('hidden');
            playBtn.classList.remove('hidden');
        });

        // Volume control
        volumeSlider.addEventListener('input', function () {
            audio.volume = parseFloat(volumeSlider.value);
        });
    });
</script>
</body>
</html>